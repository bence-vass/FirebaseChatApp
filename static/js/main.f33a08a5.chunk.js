(this["webpackJsonpreact-redux-firebase-firestore-example"]=this["webpackJsonpreact-redux-firebase-firestore-example"]||[]).push([[0],{214:function(e,t,a){e.exports=a(411)},219:function(e,t,a){},411:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(87),i=a.n(s),o=(a(219),a(14)),c=a(138),u=a.n(c),l=(a(224),a(226),a(412),a(228),a(1)),p=a(89),d=a(8),m=a(9),h=a(11),f=a(10),b=a(5),v=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("h1",null,"Firebase Chat App"))}}]),a}(r.Component),E=Object(b.d)()(v),g=a(213),O=Object(b.c)({firebase:l.firebaseReducer,firestore:p.firestoreReducer});var j={apiKey:"AIzaSyBebByNPbbIq64-sG0GjggS94k_VYcU5AA",authDomain:"fir-chat-80ffa.firebaseapp.com",databaseURL:"https://fir-chat-80ffa.firebaseio.com",projectId:"fir-chat-80ffa",storageBucket:"fir-chat-80ffa.appspot.com",messagingSenderId:"296464418613",appId:"1:296464418613:web:418b48f378c3d2d29bae7c",measurementId:"G-G64YLWBLCP"},w={userProfile:"users",enableLogging:!1},y=a(16),k=a(6),x=a(3),S=a.n(x),C=a(12),I=a(49);function L(e,t,a){return M.apply(this,arguments)}function M(){return(M=Object(C.a)(S.a.mark((function e(t,a,r){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createUser({email:a,password:r},{email:a,creationDate:Date()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,a){return A.apply(this,arguments)}function A(){return(A=Object(C.a)(S.a.mark((function e(t,a,r){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.login({email:a,password:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,a,r){return F.apply(this,arguments)}function F(){return(F=Object(C.a)(S.a.mark((function e(t,a,r,n){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.push("users/"+n+"/chats",{text:a,date_created:Date(),user:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,a){return B.apply(this,arguments)}function B(){return(B=Object(C.a)(S.a.mark((function e(t,a,r){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.database().ref("users").once("value",(function(e){e.forEach((function(e){console.log(e.key),t.push("users/"+e.key+"/chats",{text:a,date_created:Date(),user:r})}))}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return U.apply(this,arguments)}function U(){return(U=Object(C.a)(S.a.mark((function e(t,a){var r,n=arguments;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>2&&void 0!==n[2]?n[2]:null,e.next=3,t.database().ref("users/"+a).update({role:r});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={email:"test@test.com",password:"Password123",error:""},r.handleSubmit=r.handleSubmit.bind(Object(I.a)(r)),r}return Object(m.a)(a,[{key:"handleSubmit",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({error:""}),e.next=4,L(this.props.firebase,this.state.email,this.state.password).then((function(e){a.props.history.push("/")})).catch((function(e){a.setState({error:e})}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h1",null,"Sign Up"),n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("label",{htmlFor:"email"},"Email address:"),n.a.createElement("input",{type:"email",id:"email",value:this.state.email,onChange:function(t){e.setState({email:t.target.value})}}),n.a.createElement("br",null),n.a.createElement("label",{htmlFor:"password"},"Password:"),n.a.createElement("input",{type:"password",id:"password",value:this.state.password,onChange:function(t){e.setState({password:t.target.value})}}),n.a.createElement("br",null),n.a.createElement("input",{type:"submit",value:"Sign up"}),this.state.error?n.a.createElement("div",null,this.state.error.message):null))}}]),a}(r.Component),R=Object(b.d)(k.g,l.withFirestore)(q),N=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={email:"test@test.com",password:"Password123",error:""},r.handleSubmit=r.handleSubmit.bind(Object(I.a)(r)),r}return Object(m.a)(a,[{key:"handleSubmit",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({error:""}),e.next=4,_(this.props.firebase,this.state.email,this.state.password).then((function(e){a.props.history.push("/")})).catch((function(e){a.setState({error:e})}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h1",null,"Sign In"),n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("label",{htmlFor:"email"},"Email address:"),n.a.createElement("input",{type:"email",id:"email",value:this.state.email,onChange:function(t){e.setState({email:t.target.value})}}),n.a.createElement("br",null),n.a.createElement("label",{htmlFor:"password"},"Password:"),n.a.createElement("input",{type:"password",id:"password",value:this.state.password,onChange:function(t){e.setState({password:t.target.value})}}),n.a.createElement("br",null),n.a.createElement("input",{type:"submit",value:"Sign In"}),this.state.error?n.a.createElement("div",null,this.state.error.message):null))}}]),a}(r.Component),G=Object(b.d)(k.g,l.withFirestore)(N),V=a(141),W={margin:"1rem",padding:"1rem",color:"#ffffff",backgroundColor:"#4287f5",width:"60%",display:"block",float:"right"},Y={margin:"1rem",padding:"1rem",color:"#343434",backgroundColor:"#e9e6d2",width:"60%",float:"left",display:"block"},z=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return this.props.currentUserId===this.props.senderId?n.a.createElement("div",{style:W},this.props.children):n.a.createElement("div",{style:Y},this.props.children)}}]),a}(r.Component),J=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).scrollToBottom=function(){e.messagesEnd.scrollIntoView()},e.state={message:"",conversation:[]},e}return Object(m.a)(a,[{key:"componentDidUpdate",value:function(e,t,a){if(this.props.sentMessages&&this.props.receivedMessages&&(this.props.sentMessages!==e.sentMessages||this.props.receivedMessages!==e.receivedMessages)){var r=[].concat(Object(V.a)(Object.values(this.props.sentMessages)),Object(V.a)(Object.values(this.props.receivedMessages))).sort((function(e,t){return new Date(e.date_created)-new Date(t.date_created)}));this.setState({conversation:r})}this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props,a=t.auth,r=t.profile;return Object(l.isLoaded)(a)?Object(l.isEmpty)(a)?n.a.createElement(k.a,{to:"/signin"}):n.a.createElement("div",null,n.a.createElement("h1",null,"Chat"),n.a.createElement("div",{style:{height:"50vh",overflowY:"auto"}},this.state.conversation?n.a.createElement("div",null,this.state.conversation.map((function(e,t){return n.a.createElement(z,{key:t,currentUserId:a.uid,senderId:e.user},e.text)})),n.a.createElement("div",{style:{float:"right"},ref:function(t){return e.messagesEnd=t}})):n.a.createElement("div",null,"Write a message first")),n.a.createElement("div",null,n.a.createElement("textarea",{id:"message",cols:"30",rows:"10",value:this.state.message,onChange:function(t){e.setState({message:t.target.value})}}),n.a.createElement("button",{onClick:Object(C.a)(S.a.mark((function t(){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D(e.props.firebase,e.state.message,a.uid,e.props.match.params.userId);case 2:return t.next=4,e.setState({message:""});case 4:case"end":return t.stop()}}),t)})))},"Send"),"admin"===r.role?n.a.createElement("button",{onClick:Object(C.a)(S.a.mark((function t(){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P(e.props.firebase,e.state.message,a.uid);case 2:return t.next=4,e.setState({message:""});case 4:case"end":return t.stop()}}),t)})))},"Send VIP"):null)):n.a.createElement("div",null,"Loading...")}}]),a}(r.Component),X=Object(b.d)(k.g,Object(o.b)((function(e){var t=e.firebase;return{auth:t.auth,profile:t.profile}})),Object(l.firebaseConnect)((function(e){return[{path:"users/"+e.match.params.userId+"/chats",queryParams:["orderByChild=user","equalTo=".concat(e.auth.uid)],storeAs:"sentMessages"},{path:"users/"+e.auth.uid+"/chats",queryParams:["orderByChild=user","equalTo=".concat(e.match.params.userId)],storeAs:"receivedMessages"}]})),Object(o.b)((function(e){return{sentMessages:e.firebase.data.sentMessages,receivedMessages:e.firebase.data.receivedMessages}})))(J),H=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.props.users;return Object(l.isLoaded)(t)?n.a.createElement("div",null,n.a.createElement("ul",null,Object.entries(t).map((function(t,a){return t[0]===e.props.auth.uid?null:n.a.createElement(y.b,{to:"/chat/"+t[0],key:a},n.a.createElement("li",null,"user:",t[1].email))})))):n.a.createElement("div",null,"Loading...")}}]),a}(r.Component),K=Object(b.d)(k.g,Object(o.b)((function(e){var t=e.firebase;return{auth:t.auth,profile:t.profile}})),Object(l.firebaseConnect)([{path:"users",storeAs:"users"}]),Object(o.b)((function(e){return{users:e.firebase.data.users}})))(H),$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["admin"];return function(t){var a=function(a){Object(h.a)(s,a);var r=Object(f.a)(s);function s(){return Object(d.a)(this,s),r.apply(this,arguments)}return Object(m.a)(s,[{key:"render",value:function(){return Object(l.isLoaded)(this.props.profile)?!Object(l.isEmpty)(this.props.profile)&&e.includes(this.props.profile.role)?n.a.createElement(t,this.props):(console.log("You do not have permission!"),n.a.createElement(k.a,{to:"/"})):n.a.createElement("div",null,"Loading...(HOC)")}}]),s}(r.Component);return Object(b.d)(k.g,Object(o.b)((function(e){var t=e.firebase;return{auth:t.auth,profile:t.profile}})))(a)}},Q=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return console.log(this.props),Object(l.isLoaded)(this.props.users)&&Object(l.isLoaded)(this.props.moderators)?n.a.createElement("div",null,n.a.createElement("h1",null,"Admin Dashboard"),n.a.createElement("h1",null,"Moderators"),n.a.createElement("ul",null,this.props.moderators&&0!==this.props.moderators.length?Object.entries(this.props.moderators).map((function(t,a){return t[0]===e.props.auth.uid?null:n.a.createElement("li",{key:a},"user:",t[1].email,n.a.createElement("button",{onClick:Object(C.a)(S.a.mark((function a(){return S.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,T(e.props.firebase,t[0]);case 2:case"end":return a.stop()}}),a)})))},"Set to User"))})):n.a.createElement("span",null,"No moderators")),n.a.createElement("h1",null,"Users"),n.a.createElement("ul",null,this.props.users&&0!==this.props.users.length?Object.entries(this.props.users).map((function(t,a){return t[0]===e.props.auth.uid?null:n.a.createElement("li",{key:a},"user:",t[1].email,n.a.createElement("button",{onClick:Object(C.a)(S.a.mark((function a(){return S.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,T(e.props.firebase,t[0],"moderator");case 2:case"end":return a.stop()}}),a)})))},"Set to Moderator"))})):n.a.createElement("span",null,"No users"))):n.a.createElement("div",null,"Loading ...")}}]),a}(r.Component),Z=Object(b.d)($(),k.g,Object(o.b)((function(e){var t=e.firebase;return{auth:t.auth,profile:t.profile}})),Object(l.firebaseConnect)([{path:"users",queryParams:["orderByChild=role","equalTo=moderator"],storeAs:"moderators"},{path:"users",queryParams:["orderByChild=role","equalTo=null"],storeAs:"users"}]),Object(o.b)((function(e){return{moderators:e.firebase.data.moderators,users:e.firebase.data.users}})))(Q),ee=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.auth,r=t.profile;return n.a.createElement("div",null,Object(l.isLoaded)(a)&&Object(l.isEmpty)(a)?n.a.createElement("div",null,n.a.createElement("ul",null,n.a.createElement(y.b,{to:"/signup"},n.a.createElement("li",null,"Sign Up")),n.a.createElement(y.b,{to:"/signin"},n.a.createElement("li",null,"Sign In")))):n.a.createElement("div",null,n.a.createElement("h3",null,"Logged in: ",a.email),r.role?n.a.createElement("span",null,"Role: ",r.role):null,n.a.createElement("ul",null,n.a.createElement(y.b,{to:"/chat"},n.a.createElement("li",null,"Chat")),n.a.createElement(y.b,{to:"/dashboard"},n.a.createElement("li",null,"Dashboard")),n.a.createElement("li",{onClick:function(){e.props.firebase.logout()}},"Logout"))))}}]),a}(r.Component),te=Object(b.d)(l.withFirestore,Object(o.b)((function(e){var t=e.firebase;return{auth:t.auth,profile:t.profile}})))(ee),ae=(window&&window.__INITIAL_STATE__,function(e,t){var a=[g.a.withExtraArgument({getFirebase:l.getFirebase})];return Object(b.d)(b.a.apply(void 0,a),"object"===typeof window&&"undefined"!==typeof window.devToolsExtension?function(){return window.__REDUX_DEVTOOLS_EXTENSION__}:function(e){return e})(b.e)(O)}());function re(){return n.a.createElement(o.a,{store:ae},n.a.createElement(l.ReactReduxFirebaseProvider,{firebase:u.a,config:w,dispatch:ae.dispatch,createFirestoreInstance:p.createFirestoreInstance},n.a.createElement(y.a,null,n.a.createElement(te,null),n.a.createElement(k.d,null,n.a.createElement(k.b,{exact:!0,path:"/signup"},n.a.createElement(R,null)),n.a.createElement(k.b,{exact:!0,path:"/signin"},n.a.createElement(G,null)),n.a.createElement(k.b,{exact:!0,path:"/chat/:userId"},n.a.createElement(X,null)),n.a.createElement(k.b,{exact:!0,path:"/chat"},n.a.createElement(K,null)),n.a.createElement(k.b,{exact:!0,path:"/dashboard"},n.a.createElement(Z,null)),n.a.createElement(k.b,{path:"/"},n.a.createElement(E,null))))))}u.a.initializeApp(j);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[214,1,2]]]);
//# sourceMappingURL=main.f33a08a5.chunk.js.map